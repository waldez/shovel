var ShovelClient=function(e){function __webpack_require__(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}var r={};return __webpack_require__.m=e,__webpack_require__.c=r,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,r,t){__webpack_require__.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},__webpack_require__.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=2)}([function(module,exports,__webpack_require__){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _w(e){if(e instanceof Wrapper)return e;throw Error("Not a Wrapper instance")}function createWrapperClass(descriptor,typeName,typeHash,shovel){function getProperty(e,r){return shovel(e[UID_KEY],ACTIONS.get,r)}function setProperty(e,r,t){return shovel(e[UID_KEY],ACTIONS.set,r,t)}function callFunction(e,r){for(var t=arguments.length,n=Array(t>2?t-2:0),i=2;i<t;i++)n[i-2]=arguments[i];return shovel(e[UID_KEY],ACTIONS.call,r,n)}var wrapperClassName=typeName+"Wrapper",dummy=_defineProperty({},wrapperClassName,function(e){this[UID_KEY]=e}),classConstructor=dummy[wrapperClassName],proto=new Wrapper(typeName,typeHash);for(var key in descriptor){var _descriptor$key=descriptor[key],type=_descriptor$key.type,parameters=_descriptor$key.parameters;if("function"==type){var joinedPars=parameters.join(),pars=""!=joinedPars.length?","+joinedPars:"",body="(function("+joinedPars+") { return callFunction(this,'"+key+"'"+pars+"); })",fn=eval(body);proto[""+key]=fn}else proto[""+key]=function(e){return void 0===e?getProperty(this,key):setProperty(this,key,e)}}return classConstructor.prototype=proto,classConstructor.prototype.constructor=classConstructor,classConstructor}var _slicedToArray=function(){function sliceIterator(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return t}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return sliceIterator(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,t){return r&&defineProperties(e.prototype,r),t&&defineProperties(e,t),e}}(),JSONE=__webpack_require__(1),UID_KEY=Symbol("uid"),TYPE_KEY=Symbol("type"),Ξ=Symbol("private"),ACTIONS={list:"list",call:"call",get:"get",set:"set"},url="/",OK_STATUSES=[200],DEFAULT_BODY_PARSER=JSON.parse.bind(JSON),isOkStatus=function(e){return OK_STATUSES.indexOf(e)>-1},processResponse=function(e,r,t,n,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:DEFAULT_BODY_PARSER,a=t;if(isOkStatus(n))try{Promise.resolve(o(t)).then(e).catch(r)}catch(e){Promise.reject(e)}else{r({statusCode:n,statusMessage:i,response:a})}},Wrapper=function(e,r){Object.defineProperties(this,_defineProperty({},TYPE_KEY,{get:function(){return{typeName:e,typeHash:r}}}))};Wrapper.isWrapper=function(e){return e instanceof Wrapper},Wrapper.getTypeInfo=function(e){return _w(e)[TYPE_KEY]},Wrapper.getUid=function(e){return _w(e)[UID_KEY]},Wrapper.equals=function(e,r){return _w(e)[UID_KEY]==_w(r)[UID_KEY]},Wrapper.stringify=function(e){var r=_w(e);return'{"uid":'+r[UID_KEY]+',"typeHash":'+r[TYPE_KEY].typeHash+"}"};var ShovelClient=function(){function ShovelClient(e){var r=this,t=e.serviceHost,n=void 0===t?"localhost":t,i=e.servicePort,o=void 0===i?"31415":i,a=e.request;_classCallCheck(this,ShovelClient),a=a.bind(null,processResponse);var s=this,u=new Map,c=new Map,p=this.shovel.bind(this),f={Wrapper:{name:"Wrapper",ctor:Wrapper,stringify:Wrapper.stringify,parse:function(e){var t=e.uid,n=e.typeHash,i=c.get(t);if(i)return i;var o=u.get(n);return o?r[Ξ].addInstance(t,o.wrapper):null}}};this[Ξ]={JSONE:new JSONE({handlers:f}),wrappers:u,instances:c,addWrapperClass:function(e,r,t){var n=u.get(t);return n||(n=createWrapperClass(e,r,t,p),u.set(t,{wrapper:n,descriptor:e,typeName:r})),n}.bind(s),getWrapperClass:function(e){return u.get(e)}.bind(s),addInstance:function(e,r){var t=c.get(e);return t||(t=new r(e),c.set(e,t)),t}.bind(s)},this.getServiceInfo=function(){return{serviceHost:n,servicePort:o}},this.request=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];return t.host=e,t.port=r,a(t,n)}.bind(this,n,o)}return _createClass(ShovelClient,[{key:"initialize",value:function(){var e=this;return this.list(!0).then(function(){return e})}},{key:"get",value:function(e){return this[Ξ].instances.get(e)}},{key:"list",value:function(){var e=this;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){var r={action:ACTIONS.list};return this.request({method:"POST",path:url},r).then(function(r){var t=[],n=function(n){var i=r[n],o=i.descriptor,a=i.typeName,s=i.instances,u=e[Ξ].addWrapperClass(o,a,Number(n));s.forEach(function(r){e[Ξ].addInstance(r,u)}),t.push({typeName:a,instances:s})};for(var i in r)n(i);return t})}var t=new Map;return this[Ξ].instances.forEach(function(e,r){var n=e[TYPE_KEY],i=n.typeName,o=n.typeHash,a=t.get(o)||{typeName:i,instances:[]};a.instances.push(r),t.set(o,a)}),Array.from(t.values())}},{key:"shovel",value:function(e,r,t,n){var i=this[Ξ].JSONE,o=i.decode.bind(i),a={action:r,path:e,field:t,data:n};return this.request({method:"POST",path:url,bodyParser:o},i.encode(a)).then(function(r){var t=_slicedToArray(r,2);t[0];return t[1][e].data}).catch(function(e){return Promise.reject(e)})}}],[{key:"create",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.serviceHost,n=r.servicePort,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=new ShovelClient({serviceHost:t,servicePort:n,request:e});return i?o.initialize():o}},{key:"Wrapper",get:function(){return Wrapper}}]),ShovelClient}();module.exports=ShovelClient},function(e,r,t){"use strict";function isInheritable(e){return e.ctor||"function"==typeof e.instanceOf}function getNullStr(e){return"null"}function stringifyExtended(e,r){return'{"$$type":"'+e+'","$$data":'+r+"}"}function getTypeFromName(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:o)[e]}function getType(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,i=void 0===e?"undefined":n(e);if(null===e||"undefined"==i)return r.Undefined;if("object"==i){var s=Object.getPrototypeOf(e),u=r[s.constructor.name];return u&&u.ctor&&e instanceof u.ctor?u:t.find(function(r){return r.instanceOf&&r.instanceOf(e)||r.ctor&&e instanceof r.ctor})||r.Object}return r[Object.getPrototypeOf(e).constructor.name]}function arrayStringify(e){for(var r="",t="",n=0;n<e.length;n++){var i=e[n];t+=r+stringify.call(this,i),r=","}return"["+t+"]"}function objectStringify(e){var r="",t="";for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(void 0===i)continue;t+=r+JSON.stringify(n)+":"+stringify.call(this,i),r=","}return"{"+t+"}"}function decode(e){return parse.call(this,e)}function encode(e){return stringify.call(this,e)}function stringify(e){var r=getType(e,this.handlers,this.inheritables);return r.stringify?r.stringify.call(this,e):JSON.stringify(e)}function parse(e){var r=this;return JSON.parse(e,function(e,t){if(t&&t.$$type&&t.$$data){var n=getTypeFromName(t.$$type,r.handlers);return n.parse?n.parse(t.$$data):t}return t})}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function sliceIterator(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return t}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return sliceIterator(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o={Undefined:{name:"Undefined",stringify:getNullStr},Boolean:{name:"Boolean"},Number:{name:"Number"},String:{name:"String"},Object:{name:"Object",stringify:objectStringify},Function:{name:"Function",ctor:Function,stringify:getNullStr},Date:{name:"Date",ctor:Date,stringify:function(e){return stringifyExtended("Date",'"'+e.toISOString()+'"')},parse:function(e){return new Date(e)}},RegExp:{name:"RegExp",ctor:RegExp,stringify:function(e){return stringifyExtended("RegExp",'["'+e.source+'","'+e.flags+'"]')},parse:function(e){var r=i(e,2),t=r[0],n=r[1];return new RegExp(t,n)}},Error:{name:"Error",ctor:Error},Array:{name:"Array",ctor:Array,stringify:arrayStringify}},a=Object.keys(o).map(function(e){return o[e]}).filter(isInheritable),s=function(e){var r=e.handlers;for(var t in r)r.hasOwnProperty(t)&&function(){var e=r[t];if("function"==typeof e.stringify){var n=e.stringify.bind(e);e.stringify=function(r){return stringifyExtended(e.name,n(r))}}}();this.handlers=Object.assign({},o,r),this.inheritables=Object.keys(r).map(function(e){return r[e]}).filter(isInheritable)},u={decode:decode,encode:encode,stringify:stringify,parse:parse};Object.assign(s,u),s.prototype=u,e.exports=s},function(e,r,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=t(0),o=function(e,r,t){var i=r.method,o=void 0===i?"POST":i,a=r.port,s=r.host,u=r.path,c=void 0===u?"/":u,p=r.bodyParser;return new Promise(function(r,i){t="object"===(void 0===t?"undefined":n(t))?JSON.stringify(t):t;var u=new XMLHttpRequest;u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&e(r,i,u.responseText,u.status,void 0,p)},u.open(o,"http://"+s+":"+a+c,!0),u.send(t)})};e.exports=i.create.bind(null,o)}]);